# Hasura Permissions Configuration
# This file defines the GraphQL permissions for the user role

# Chats table permissions
chats:
  role: user
  permissions:
    select:
      filter:
        user_id:
          _eq: X-Hasura-User-Id
      columns:
        - id
        - user_id
        - title
        - created_at
        - updated_at
      allow_aggregations: true
    
    insert:
      check:
        user_id:
          _eq: X-Hasura-User-Id
      columns:
        - title
        - user_id
      set:
        user_id: X-Hasura-User-Id
    
    update:
      filter:
        user_id:
          _eq: X-Hasura-User-Id
      columns:
        - title
      check:
        user_id:
          _eq: X-Hasura-User-Id
    
    delete:
      filter:
        user_id:
          _eq: X-Hasura-User-Id

# Messages table permissions
messages:
  role: user
  permissions:
    select:
      filter:
        chat:
          user_id:
            _eq: X-Hasura-User-Id
      columns:
        - id
        - chat_id
        - user_id
        - content
        - is_bot
        - created_at
        - updated_at
      allow_aggregations: true
    
    insert:
      check:
        chat:
          user_id:
            _eq: X-Hasura-User-Id
      columns:
        - chat_id
        - content
        - is_bot
        - user_id
      set:
        user_id: X-Hasura-User-Id
    
    update:
      filter:
        chat:
          user_id:
            _eq: X-Hasura-User-Id
      columns:
        - content
      check:
        chat:
          user_id:
            _eq: X-Hasura-User-Id
    
    delete:
      filter:
        chat:
          user_id:
            _eq: X-Hasura-User-Id

# Relationships
relationships:
  chats:
    - name: messages
      using:
        foreign_key_constraint_on:
          table: messages
          column: chat_id
    - name: user
      using:
        foreign_key_constraint_on: user_id
  
  messages:
    - name: chat
      using:
        foreign_key_constraint_on: chat_id
    - name: user
      using:
        foreign_key_constraint_on: user_id

